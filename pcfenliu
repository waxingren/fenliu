# 代理监听端口
mixed-port: 7890  # 代理服务监听的端口（通常是 HTTP/HTTPS 代理端口）
ipv6: false  # 禁用 IPv6
allow-lan: true  # 允许局域网设备访问代理服务
unified-delay: false  # 不统一延迟策略，允许每个连接有不同的延迟策略
tcp-concurrent: true  # 允许 TCP 并发连接
external-controller: 127.0.0.1:9090  # 外部控制器的地址和端口，用于与代理服务通信（如 API 控制）
external-ui: ui  # 使用外部 UI 界面，默认位置是 "ui"
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"  # 外部 UI 的下载地址
keep-alive-interval: 1800  # 保持连接的时间间隔，单位为秒，1800 秒 = 30 分钟

# GeoIP 设置，用于按地理位置选择代理节点
geodata-mode: true  # 启用地理数据模式
geodata-loader: standard  # 使用标准的地理数据加载器
geo-auto-update: false  # 禁止自动更新地理数据
geo-update-interval: 24  # 每 24 小时更新一次地理数据
geox-url:
  geoip: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat"  # GeoIP 数据源 URL
  geosite: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"  # GeoSite 数据源 URL
  mmdb: "https://cdn.jsdelivr.net/gh/soffchen/GeoIP2-CN@release/Country.mmdb"  # GeoIP2 国家数据 URL
  asn: "https://mirror.ghproxy.com/https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"  # ASN 数据源 URL

# 进程监控设置
find-process-mode: strict  # 严格模式，尽可能找到所有进程
global-client-fingerprint: chrome  # 设置全局客户端指纹为 Chrome

# 配置文件和流量嗅探设置
profile:
  store-selected: true  # 存储选择的配置文件
  store-fake-ip: true  # 存储虚拟 IP 地址

# 嗅探设置，用于识别特定流量协议（如 HTTP、TLS、QUIC）
sniffer:
  enable: true  # 启用流量嗅探
  sniff:
    HTTP:
      ports: [80, 8080-8880]  # 嗅探 HTTP 流量的端口范围
      override-destination: true  # 覆盖目标 IP 地址
    TLS:
      ports: [443, 8443]  # 嗅探 TLS 流量的端口
    QUIC:
      ports: [443, 8443]  # 嗅探 QUIC 流量的端口
  skip-domain:  # 不嗅探以下域名的流量
    - "Mijia Cloud"  # 跳过米家云的流量
    - "+.push.apple.com"  # 跳过 Apple 的推送服务域名

# TUN 模式配置，通常用于代理流量转发到虚拟网络接口
tun:
  enable: true  # 启用 TUN 模式
  stack: mixed  # 使用混合协议栈（TCP/UDP 都支持）
  dns-hijack:
    - "any:53"  # 劫持所有 53 端口的 DNS 请求
    - "tcp://any:53"  # 劫持 TCP 53 端口的 DNS 请求
  auto-route: true  # 自动路由流量
  auto-redirect: true  # 自动重定向流量
  auto-detect-interface: true  # 自动检测网络接口

# DNS 配置部分
dns:
  enable: true  # 启用 DNS 功能
  ipv6: false  # 禁用 IPv6 的 DNS 查询
  respect-rules: true  # 尊重 DNS 规则配置
  enhanced-mode: fake-ip  # 使用 fake-ip 模式增强 DNS 功能
  fake-ip-filter:
    - "*"  # 所有请求都使用虚拟 IP
    - "+.lan"  # 局域网地址使用虚拟 IP
    - "+.local"  # 本地地址使用虚拟 IP
    - "+.market.xiaomi.com"  # 小米市场域名使用虚拟 IP
  nameserver:
    - https://120.53.53.53/dns-query  # 使用的 DNS 服务器 1（支持 DNS-over-HTTPS）
    - https://223.5.5.5/dns-query  # 使用的 DNS 服务器 2（支持 DNS-over-HTTPS）
  proxy-server-nameserver:
    - https://120.53.53.53/dns-query  # 代理服务器的 DNS 服务器 1
    - https://223.5.5.5/dns-query  # 代理服务器的 DNS 服务器 2
  nameserver-policy:
    "rule-set:direct,private":  # 对中国域名和私有域名使用指定的 DNS
      - https://120.53.53.53/dns-query
      - https://223.5.5.5/dns-query
    "rule-set:zxgz,ai,telegram":  # 对非中国地区的域名使用其他 DNS
      - "https://dns.cloudflare.com/dns-query"  # Cloudflare 的 DNS 服务
      - "https://dns.google/dns-query"  # Google 的 DNS 服务


# 过滤规则
FilterHK: &FilterHK '^(?!.*(群|邀请|跳过|返利|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持|教程|关注|更新|作者|加入|com)).*(香港|HK|Hong|🇭🇰).*'
FilterJP: &FilterJP '^(?!.*(群|邀请|返利|跳过|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持|教程|关注|更新|作者|加入|com)).*(日本|JP|Japan|🇯🇵).*'
FilterSG: &FilterSG '^(?!.*(群|邀请|返利|跳过|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持|教程|关注|更新|作者|加入|com)).*(新加坡|SG|Singapore|🇸🇬).*'
FilterUS: &FilterUS '^(?!.*(群|邀请|返利|跳过|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持|教程|关注|更新|作者|加入|com)).*(美国|US|United States|America|🇺🇸).*'
FilterOthers: &FilterOthers '^(?!.*(🇭🇰|HK|Hong|香港|🇯🇵|JP|Japan|日本|🇸🇬|SG|Singapore|新加坡|🇺🇸|US|United States|America|美国|群|邀请|返利|跳过|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持|教程|关注|更新|作者|加入|com)).*$'
FilterAll: &FilterAll '^(?=.*(.))(?!.*((?i)群|邀请|返利|循环|官网|客服|网站|网址|获取|订阅|流量|到期|机场|下次|版本|官址|备用|过期|已用|联系|邮箱|工单|跳过|贩卖|通知|倒卖|防止|国内|地址|频道|无法|说明|使用|提示|特别|访问|支持|教程|关注|更新|作者|加入|com|(\b(USE|USED|TOTAL|EXPIRE|EMAIL|Panel|Channel|Author)\b|(\d{4}-\d{2}-\d{2}|\d+G)))).*$'


# 手动选择参数
Select: &Select {type: select, url: 'https://cp.cloudflare.com', disable-udp: false, hidden: false, include-all: true}

# 策略组
proxy-groups: 
  - {name: 🎯 节点选择, type: select, proxies: [手动选择, DIRECT], url: https://cp.cloudflare.com, icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Static.png}
  - {name: 手动选择, type: select, proxies: [🇭🇰香港,🇸🇬新加坡,其他节点], url: https://cp.cloudflare.com, icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Cylink.png}
  - {name: 🇭🇰香港, <<: *Select, filter: *FilterHK}
  - {name: 🇸🇬新加坡, <<: *Select, filter: *FilterSG}
  - {name: 🇯🇵日本, <<: *Select, filter: *FilterJP}  
  - {name: 🇺🇸美国, <<: *Select, filter: *FilterUS}
  - {name: 低延迟, type: select, proxies: [🇺🇸美国, 🇯🇵日本], icon: https://raw.githubusercontent.com/Orz-3/mini/refs/heads/master/Color/Auto.png}
  - {name: 视频下载, <<: *Select, filter: *FilterAll, icon: https://fastly.jsdelivr.net/gh/Orz-3/mini@master/Color/LineTV.png}  
  - {name: 其他节点, <<: *Select, filter: *FilterOthers, icon: https://fastly.jsdelivr.net/gh/Orz-3/mini@master/Color/Global.png}

# 订阅规则
rule-providers:
  # 直连域名列表
  direct:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400

  # 私有网络专用域名列表
  private:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./ruleset/private.yaml
    interval: 86400

  # Apple 在中国大陆可直连的域名列表
  apple:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
    path: ./ruleset/apple.yaml
    interval: 86400

  # iCloud 域名列表
  icloud:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
    path: ./ruleset/icloud.yaml
    interval: 86400

  # AI 域名列表
  ai:
    type: http
    behavior: classical
    url: "https://testingcf.jsdelivr.net/gh/dler-io/Rules@main/Clash/Provider/AI%20Suite.yaml"
    path: ./ruleset/ai.yaml
    interval: 86400

  # Telegram 使用的 IP 地址列表
  telegram:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt"
    path: ./ruleset/telegram.yaml
    interval: 86400

  # 局域网 IP 及保留 IP 地址列表
  lan:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: ./ruleset/lan.yaml
    interval: 86400

  # 中国大陆 IP 地址列表
  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.yaml
    interval: 86400

  # 自定义规则集
  zxgz:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/waxingren/fenliu/refs/heads/main/spxz.yaml"
    path: ./ruleset/zxgz.yaml
    interval: 86400

  # 直连软件
  applications:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/waxingren/fenliu/refs/heads/main/appfenliu.yaml"
    path: ./ruleset/applications.yaml
    interval: 86400
  
# 分流规则
rules:
  ### 非 IP 类规则
  - RULE-SET,zxgz,视频下载  # 自定义规则集 zxgz，用于视频下载
  - RULE-SET,ai,🇺🇸美国
  - RULE-SET,applications,DIRECT  # 直连软件
  - RULE-SET,direct,DIRECT  # 直连域名列表
  - RULE-SET,private,DIRECT  # 私有网络专用域名列表
  - RULE-SET,apple,DIRECT  # Apple 在中国大陆可直连的域名列表
  - RULE-SET,icloud,DIRECT  # iCloud 域名列表
  # ai 域名列表
  ### IP 类规则
  - RULE-SET,telegram,低延迟  # Telegram 使用的 IP 地址列表
  - RULE-SET,cncidr,DIRECT,no-resolve  # 中国大陆 IP 地址列表
  - RULE-SET,lan,DIRECT,no-resolve  # 局域网 IP 及保留 IP 地址列表
  - GEOIP,lan,DIRECT,no-resolve  # 局域网 IP
  - GEOIP,CN,DIRECT  # 中国大陆 IP

  ### 默认匹配策略
  - MATCH,🎯 节点选择  
